.. _pymongo-whats-new:

What's New
==========
.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. facet::
   :name: genre
   :values: reference

.. meta::
   :keywords: update, new feature, deprecation, upgrade, driver v4.7, driver v4.6

Learn what's new in:

* :ref:`Version 4.7 <version-4.7>`
* :ref:`Version 4.6 <version-4.6>`

.. _upcoming-breaking-changes:

.. _version-4.7:

What's New in 4.7
-----------------

The 4.7 driver release includes the following new features:

- Added the
  `pymongo.monitoring.CommandStartedEvent.server_connection_id <{+api-root+}/monitoring.html#pymongo.monitoring.CommandStartedEvent.server_connection_id>`__,
  `pymongo.monitoring.CommandSucceededEvent.server_connection_id <{+api-root+}/monitoring.html#pymongo.monitoring.CommandSucceededEvent.server_connection_id>`__,
  and `pymongo.monitoring.CommandFailedEvent.server_connection_id <{+api-root+}/monitoring.html#pymongo.monitoring.CommandFailedEvent.server_connection_id>`__
  properties.
- Fixed a bug where inflating a ``RawBSONDocument`` object containing a
  ``Code`` would cause an error.
- Replaced usage of ``bson.son.SON`` on all internal classes and commands to dict,
  :attr:`options.pool_options.metadata` is now of type ``dict`` as opposed to ``bson.son.SON``.
- Significantly improved the performance of encoding BSON documents to JSON.
- Support for named KMS providers for client side field level encryption.
  Previously supported KMS providers were only: aws, azure, gcp, kmip, and local.
  The KMS provider is now expanded to support name suffixes (e.g. local:myname).
  Named KMS providers enables more than one of each KMS provider type to be configured.
  See the docstring for ``~pymongo.encryption_options.AutoEncryptionOpts``.
  Note that named KMS providers requires pymongocrypt >=1.9 and libmongocrypt >=1.9.
- Fixed a bug where ``~bson.int64.Int64`` instances could not always be encoded
  by `orjson`_. The following now works::

    >>> import orjson
    >>> from bson import json_util
    >>> orjson.dumps({'a': Int64(1)}, default=json_util.default, option=orjson.OPT_PASSTHROUGH_SUBCLASS)

.. _orjson: https://github.com/ijl/orjson

.. _version-4.6:
.. _version-4.6.1:

What's New in 4.6.1
-------------------

The 4.6.1 driver release includes the following new features:

- Ensures retryable read ``OperationFailure`` errors re-raise exception when ``0`` or
  ``NoneType`` error code is provided.

.. _version-4.6.0:

What's New in 4.6.0
-------------------

The 4.6 driver release includes the following new features:

- Added the ``serverMonitoringMode`` URI and keyword argument to ``~pymongo.mongo_client.MongoClient``.
- Improved client performance and reduced connection requirements in Function-as-a-service (FaaS)
  environments like AWS Lambda, Google Cloud Functions, and Microsoft Azure Functions.
- Added the :attr:`pymongo.monitoring.CommandSucceededEvent.database_name` property.
- Added the :attr:`pymongo.monitoring.CommandFailedEvent.database_name` property.
- Allow passing a ``dict`` to sort/create_index/hint.
- Added :func:`repr` support to the write result classes:
  ``~pymongo.results.BulkWriteResult``,
  ``~pymongo.results.DeleteResult``,
  ``~pymongo.results.InsertManyResult``,
  ``~pymongo.results.InsertOneResult``,
  ``~pymongo.results.UpdateResult``, and
  ``~pymongo.encryption.RewrapManyDataKeyResult``. For example:

    >>> client.t.t.insert_one({})
    InsertOneResult(ObjectId('65319acdd55bb3a27ab5502b'), acknowledged=True)
    >>> client.t.t.insert_many([{} for _ in range(3)])
    InsertManyResult([ObjectId('6532f85e826f2b6125d6ce39'), ObjectId('6532f85e826f2b6125d6ce3a'), ObjectId('6532f85e826f2b6125d6ce3b')], acknowledged=True)

- :py:meth`~pymongo.uri_parser.parse_uri` now considers the delimiting slash (``/``)
  between hosts and connection options optional. For example,
  "mongodb://example.com?tls=true" is now a valid URI.
- Fixed a bug where PyMongo would incorrectly promote all cursors to exhaust cursors
  when connected to load balanced MongoDB clusters or Serverless clusters.
- Added the :ref:`network-compression-example` documentation page.
- Added more timeout information to network errors.